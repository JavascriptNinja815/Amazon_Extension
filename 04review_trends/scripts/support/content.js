function launchimport(){alert("Import Templates")}function edittemplates(){alert("Edit Templates")}function process(t){"ok"!=t&&(window.open(chrome.extension.getURL("options.html")),$("#supportsushi").hide())}function gethavea(){var t=new Date,e=t.getDay();return 0==e||6==e||5==e?"Have a nice weekend!":1==e||2==e?"Have a great week!":"Have a great day!"}function capitalizeFirstLetter(t){return t.charAt(0).toUpperCase()+t.slice(1)}function toTitleCase(t){return t.replace(/\w\S*/g,function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})}function loadtemplate(t){chrome.storage.local.get("template"+t,function(t){var e=t[Object.keys(t)[0]],a=$(".tiny").first().html().replace(/[()]/g,""),s=a.split("@")[0],o=$('a[href*="'+s+'"]').text();o=toTitleCase(replaceAll(o,"Unsubscribe User",""));var i=capitalizeFirstLetter(o.split(" ")[0]);e=replaceAll(e,"{{FIRSTNAME}}",i),e=replaceAll(e,"{{FULLNAME}}",o),e=replaceAll(e,"{{ADDRESS}}",theaddress),e=replaceAll(e,"{{CHARGE}}",thecharge),e=replaceAll(e,"{{ASIN}}",theasin),e=replaceAll(e,"{{HAVEA}}",gethavea()),$("#commMgrCompositionMessage").val(e)})}function replaceAll(t,e,a){return t.replace(new RegExp(e,"g"),a)}function trashtemplate(t){if(confirm("Are you sure you want to delete this template?")){var e="template"+t,a="templatetag"+t,s={};s[e]="removed",chrome.storage.local.set(s);var s={};s[a]="removed",chrome.storage.local.set(s),$(".divfortemplate[tid='"+t+"']").hide()}}function addTemplatesFromImport(t){if(0!=t.length){var e=t[0],a=e.tag,s=e.email;chrome.storage.local.get("ntemplates",function(e){var o=e.ntemplates,i=chrome.extension.getURL("images/trash.png"),n=chrome.extension.getURL("images/edit.png");$("#notemplates").hide(),$("#templates").append('<div class="divfortemplate" tid="'+o+'"><button style="width:100%;" class="awesomeButton buttonLarge primaryLargeButton loadtemplatebutton" type="button" tid="'+o+'"><span class="button_label">'+a+'</span></button><br><img align="right" src="'+n+'" tid="'+o+'" class="edittemplate" style="cursor:pointer;margin-top:5px;"><img align="right" src="'+i+'" tid="'+o+'" class="trashtemplate" style="cursor:pointer;margin-bottom:15px;margin-right:15px;margin-top:5px;"></div>');var l="templatetag"+o,r="template"+o,p={};p[l]=a,chrome.storage.local.set(p);var p={};p[r]=s,chrome.storage.local.set(p);var c=o+1;chrome.storage.local.set({ntemplates:c},function(){t.splice(0,1),addTemplatesFromImport(t)})})}}function download(t,e,a){var s=document.createElement("a"),o=new Blob([t],{type:a});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(o,e);else{var i=URL.createObjectURL(o);s.href=i,s.download=e,document.body.appendChild(s),s.click(),setTimeout(function(){document.body.removeChild(s),window.URL.revokeObjectURL(i)},0)}}function addtemplate(){"yes"==$("#supportsushi_addtemplate").attr("isactive")?$("#supportsushi_addtemplate").show():$('<div class="cols-r1" isactive="yes" id="supportsushi_addtemplate"><div class="righttitle" style="background-color:#F90;">Add New Template</div><div> <div>Tag:<br><input type="text" style="width:100%" maxlength="30" id="newtemplatetag"></div>   <div>Template:<br><textarea id="newtemplatecontent" style="width:100%;" rows="10"></textarea></div>   <div><button class="awesomeButton buttonLarge primaryLargeButton" style="margin-top:15px;" type="button" id="add_button"><span class="button_label" style="font-weight:bold;">Add</span><button class="awesomeButton buttonLarge secondaryLargeButton" style="margin-top:15px;" type="button" id="cancelbutton"><span class="button_label" style="font-weight:bold;">Cancel</span></button></div></div>').insertAfter(".cols-r1:last")}function edittemplate(t){chrome.storage.local.get("template"+t,function(e){var a=e[Object.keys(e)[0]],s=$(".divfortemplate[tid='"+t+"'] button span").html();"yes"==$("#supportsushi_edittemplate").attr("isactive")?($("#edittid").attr("tid",t),$("#supportsushi_edittemplate").show(),$("#edittemplatecontent").val(a),$("#edittemplatetag").val(s)):$('<div class="cols-r1" isactive="yes" id="supportsushi_edittemplate"><span id="edittid" tid="'+t+'"></span><div class="righttitle" style="background-color:#F90;">Edit Template</div><div> <div>Tag:<br><input type="text" style="width:100%" value="'+s+'" maxlength="30" id="edittemplatetag"></div>   <div>Template:<br><textarea id="edittemplatecontent" style="width:100%;" rows="10">'+a+'</textarea></div>   <div><button class="awesomeButton buttonLarge primaryLargeButton" style="margin-top:15px;" type="button" id="save_button"><span class="button_label" style="font-weight:bold;">Save</span><button class="awesomeButton buttonLarge secondaryLargeButton" style="margin-top:15px;" type="button" id="canceleditbutton"><span class="button_label" style="font-weight:bold;">Cancel</span></button></div></div>').insertAfter(".cols-r1:last")})}function canceledit(){$("#supportsushi_edittemplate").hide()}function saveedit(){var t=$("#edittid").attr("tid"),e=$("#edittemplatecontent").val(),a=$("#edittemplatetag").val(),s="templatetag"+t,o="template"+t,i={};i[s]=a,chrome.storage.local.set(i);var i={};i[o]=e,chrome.storage.local.set(i),$(".divfortemplate[tid='"+t+"'] button span").html(a),canceledit()}function canceladd(){$("#supportsushi_addtemplate").hide()}function handleFiles(t){var e=t[0],a=new FileReader;a.onload=function(t){var e=t.target.result,a=JSON.parse(e);if("sushi"==a.type){var s=a.templates;addTemplatesFromImport(s)}else alert("Invalid file. Please load a .sushi file.")},a.readAsText(e)}chrome.runtime.onMessage.addListener(function(t,e,a){"user_email_please"==t.greeting&&a({user_email:$(".tiny").first().html()})}),chrome.storage.sync.get("license",function(t){var e=t.license,a="https://sushibytes.io/check.php?license="+e;$.ajax({type:"GET",url:a,beforeSend:function(){},success:function(t){process(t)},error:function(t){process(t)}})});var theaddress="",theasin="",thecharge="",processedtemplates=0,totaltemplates=0,t_for_e={};$(document).ready(function(){function t(t){var e=document.createElement("DIV");return e.innerHTML=t,e.textContent||e.innerText||""}function e(e){if("hereistheaddress"==e.command){chrome.runtime.sendMessage({command:"closetab"});var a=e.datax;console.log(a);var s=a.split("~~~"),o=s[0],i=s[1],n=s[2];o=replaceAll(o,"<br>","~#~"),o=t(o),o=o.replace(/\s+/g," "),o=replaceAll(o,"~#~","\n"),i=t(i),i=i.replace(/\s+/g,""),n=t(n),n=n.replace(/\s+/g,""),theaddress=o,thecharge=n,theasin=i,console.log(e),chrome.storage.local.set({address:o},function(){$("#tempsushi").hide(),$("#mainsushi").show()})}}function a(){var t=Array();for(var e in t_for_e)t_for_e.hasOwnProperty(e)&&t.push(t_for_e[e]);var a={type:"sushi",templates:t},s=JSON.stringify(a);download(s,"templates.sushi","text")}$('a[href*="orderID="]').each(function(){var t=$(this).attr("href"),e=t.split("orderID="),a=e[1];chrome.runtime.sendMessage({command:"getaddress",orderid:a})}),chrome.runtime.onMessage.addListener(e),$("body").on("click","button.loadtemplatebutton",function(){var t=$(this).attr("tid");loadtemplate(t)}),$("body").on("click","#exportlink",function(){processedtemplates=0,chrome.storage.local.get("ntemplates",function(t){if("undefined"==typeof t.ntemplates&&chrome.storage.local.set({ntemplates:0}),ntemplates=t.ntemplates,totaltemplates=ntemplates,ntemplates>0)for(i=0;i<ntemplates;i++)chrome.storage.local.get("templatetag"+i,function(t){var e=t[Object.keys(t)[0]];if("removed"!=e){var s=Object.keys(t)[0].match(/\d+$/),o=s[0];t_for_e[o]={},t_for_e[o].tag=e,console.log("TID: "+o),chrome.storage.local.get("template"+o,function(t){processedtemplates++;var e=Object.keys(t)[0].match(/\d+$/),s=e[0],o=t[Object.keys(t)[0]];t_for_e[s].email=o,processedtemplates==totaltemplates&&a()})}else processedtemplates++});else $("#templates").html('<br><i id="notemplates">No templates available.</i>')})}),$("body").on("click",".trashtemplate",function(){var t=$(this).attr("tid");trashtemplate(t)}),$("body").on("click",".edittemplate",function(){var t=$(this).attr("tid");edittemplate(t)}),$("body").on("click","#addtemplatebutton",function(){addtemplate()}),$("body").on("click","#cancelbutton",function(){canceladd()}),$("body").on("click","#save_button",function(){saveedit()}),$("body").on("click","#canceleditbutton",function(){canceledit()}),$("body").on("click","#add_button",function(){var t=$("#newtemplatecontent").val(),e=$("#newtemplatetag").val();chrome.storage.local.get("ntemplates",function(a){var s=a.ntemplates,o=chrome.extension.getURL("images/trash.png"),i=chrome.extension.getURL("images/edit.png");$("#notemplates").hide(),$("#templates").append('<div class="divfortemplate" tid="'+s+'"><button style="width:100%;" class="awesomeButton buttonLarge primaryLargeButton loadtemplatebutton" type="button" tid="'+s+'"><span class="button_label">'+e+'</span></button><br><img align="right" src="'+i+'" tid="'+s+'" class="edittemplate" style="cursor:pointer;margin-top:5px;"><img align="right" src="'+o+'" tid="'+s+'" class="trashtemplate" style="cursor:pointer;margin-bottom:15px;margin-right:15px;margin-top:5px;"></div>');var n="templatetag"+s,l="template"+s,r={};r[n]=e,chrome.storage.local.set(r);var r={};r[l]=t,chrome.storage.local.set(r);var p=s+1;chrome.storage.local.set({ntemplates:p},function(){alert("Template successfully added.")})}),canceladd()}),$("body").on("change","#importtemplatefile",function(){var t=this.files;handleFiles(t)});var s=($(".tiny").first().html().replace(/[()]/g,""),chrome.extension.getURL("images/loading2.gif"));$('<div class="cols-r1" id="supportsushi"><div class="righttitle" style="background-color:#F90;">SupportSushi</div><div id="tempsushi"><center><img src="'+s+'"></center></div><div id="mainsushi" style="display:none;line-height:1.4em;"><br><strong>Load a Response Template</strong><div id="templates"><br></div><div><button class="awesomeButton buttonLarge secondaryLargeButton" style="margin-top:15px;" type="button" id="addtemplatebutton"><span class="button_label" style="font-weight:bold;">+ Add New Template</span></button></div> <div>Import Templates: <input type="file" id="importtemplatefile"></div> <div><a href="#" id="exportlink" style="margin-top:15px;"><i>Export Templates</i></a></div> <div>Tokens: {{FIRSTNAME}} {{FULLNAME}} {{ADDRESS}} {{ASIN}} {{CHARGE}}</div> </div></div>').insertAfter(".cols-r1:last"),chrome.storage.local.get("ntemplates",function(t){if("undefined"==typeof t.ntemplates&&chrome.storage.local.set({ntemplates:0}),ntemplates=t.ntemplates,ntemplates>0)for(i=0;i<ntemplates;i++)chrome.storage.local.get("templatetag"+i,function(t){var e=t[Object.keys(t)[0]];if("removed"!=e){var a=Object.keys(t)[0].match(/\d+$/),s=a[0],o=chrome.extension.getURL("images/trash.png"),i=chrome.extension.getURL("images/edit.png");$("#templates").append('<div class="divfortemplate" tid="'+s+'"><button style="width:100%;" class="awesomeButton buttonLarge primaryLargeButton loadtemplatebutton" type="button" tid="'+s+'"><span class="button_label">'+e+'</span></button><br><img align="right" style="cursor:pointer;margin-top:5px;" src="'+i+'" tid="'+s+'" class="edittemplate"><img align="right" src="'+o+'" tid="'+s+'" class="trashtemplate" style="margin-bottom:15px;cursor:pointer;margin-right:15px;margin-top:5px;"></div>')}});else $("#templates").html('<br><i id="notemplates">No templates available.</i>')})});